<!DOCTYPE html>
<html>
	<head>
		<title>Quit Smoking!</title>

		<style>
			svg
			{
				width: 800px;
				height: 500px;
			}

			.h1
			{
				font: bold 16px verdana;
				fill: rgba(0, 0, 0, 1);
			}
			
			.scaleTick, .axesTick, .axesVertical, .axesHorizontal
            {
                stroke: rgba(100, 100, 100, 1);
                stroke-width: 1px;
            }  

            .scaleText
            {
                font: 8px verdana;
                fill: rgba(100, 100, 100, 1);
                text-anchor: end;
            }

			.lineChart
            {
                stroke: rgba(0, 0, 0, 1);
                stroke-width: 2px;
            } 
		</style>

		<script src="https://d3js.org/d3.v4.min.js"></script>
	</head>

	<body>
		<h1>The Chinups - Cigarettes Combo Chart</h1>

		<svg>

		</svg>

		<script>
			let comboChart = 
			{
				cigData: [],
				chinupData: [],
				maxUnits: 10,
				dataPoints: 1,
				drawCharts: function() 
				{
					var svgChart = d3.select("svg");
					svgChart.html("");

					this.drawAxes(svgChart);
				},
				drawAxes: function(chart) 
				{
					chart
	                .append("line")
	                .attr("class", "axesVertical")
	                .attr("x1", "50px")
	                .attr("y1", "50px")
	                .attr("x2", "50px")
	                .attr("y2", "450px");

					chart
	                .append("line")
	                .attr("class", "axesHorizontal")
	                .attr("x1", "50px")
	                .attr("y1", "450px")
	                .attr("x2", "750px")
	                .attr("y2", "450px");

					var pxPerUnit = Math.floor(400 / this.maxUnits);
					var pxPerPoint = Math.floor(700 / this.dataPoints);

					var scale = [];
					for (var i = 450; i >= 50; i -= pxPerUnit)
					{
						scale.push(i);
					}

	                chart.selectAll("line.scaleTick")
	                .data(scale)
	                .enter()
	                .append("line")
	                .attr("class", "scaleTick")
	                .attr("x1", "40px")
	                .attr("y1", function(d) 
	                {
	                    return d + "px";
	                })
	                .attr("x2", "50px")   
	                .attr("y2", function(d) 
	                {
	                    return d + "px";
	                });

	                chart.selectAll("text.scaleText")
	                .data(scale)
	                .enter()
	                .append("text")
	                .attr("class", "scaleText")
	                .attr("x", "30px")
	                .attr("y", function(d) 
	                {
	                    return d + "px";
	                })
	                .text(
	                function(d, i) 
	                {
	                    return i;
	                });	 

					var axes = [];
					for (var i = 750; i >= 50; i -= pxPerPoint)
					{
						axes.push(i);
					}

	                chart.selectAll("line.axesTick")
	                .data(axes)
	                .enter()
	                .append("line")
	                .attr("class", "axesTick")
	                .attr("x1", function(d) 
	                {
	                    return d + "px";
	                })
	                .attr("y1", "450px")
	                .attr("x2", function(d) 
	                {
	                    return d + "px";
	                })
	                .attr("y2", "460px");

	                this.drawLines(chart, pxPerUnit, pxPerPoint);	                             
				},
				drawLines: function(chart, pxPerUnit, pxPerPoint) 
				{
					var cigData = this.cigData;
console.log(this.maxUnits, this.dataPoints)
	                chart.selectAll("line.lineChart")
	                .data(cigData)
	                .enter()
	                .append("line")
	                .attr("class", "lineChart")
	                .attr("x1", function(d, i) 
	                {
	                    var val = i;

	                    if (i > 0)
	                    {
	                        val = val - 1;                   
	                    }

	                    return ((val * pxPerPoint) + 50) + "px";
	                })
	                .attr("x2", function(d, i) 
	                {
	                    return ((i * pxPerPoint) + 50) + "px";
	                })
	                .attr("y1", function(d, i) 
	                {
	                    var val = d;

	                    if (i > 0)
	                    {
	                        val = cigData[i - 1];
	                    }

	                    return (450 - (val * pxPerUnit)) + "px";
	                })
	                .attr("y2", function(d) 
	                {
	                    return (450 - (d * pxPerUnit)) + "px";
	                });
				},
				drawBars: function(chart, pxPerUnit, pxPerPoint) 
				{

				}
			};

			d3.csv("combo.csv", function(data) 
			{
				console.log(data);
				comboChart.dataPoints = data.length;

			    for (var i = 0; i < data.length; i++) 
			    {
			    	comboChart.chinupData.push(data[i].Reps);
			    	comboChart.cigData.push(data[i].Cigs);
			    }

			    comboChart.drawCharts();
			});
		</script>
	</body>
</html>